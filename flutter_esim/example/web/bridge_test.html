<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EsimNativeBridge Test Demo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4ec9b0;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        h2 {
            color: #569cd6;
            margin-top: 30px;
        }
        .section {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #0e5a0e; color: #4ec9b0; }
        .status.error { background: #5a0e0e; color: #f48771; }
        .status.warning { background: #5a5a0e; color: #dcdcaa; }
        .status.info { background: #0e3a5a; color: #9cdcfe; }
        
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover {
            background: #1177bb;
        }
        button:active {
            background: #0d527d;
        }
        button:disabled {
            background: #3e3e42;
            color: #808080;
            cursor: not-allowed;
        }
        
        input, textarea {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            color: #d4d4d4;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .log-container {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-left: 3px solid transparent;
        }
        .log-entry.info { border-left-color: #9cdcfe; }
        .log-entry.success { border-left-color: #4ec9b0; }
        .log-entry.error { border-left-color: #f48771; }
        .log-entry.warn { border-left-color: #dcdcaa; }
        
        .timestamp {
            color: #858585;
            margin-right: 10px;
        }
        
        .flow-diagram {
            background: #252526;
            padding: 15px;
            border-radius: 3px;
            overflow-x: auto;
            white-space: pre;
            font-size: 11px;
            line-height: 1.4;
        }
        
        code {
            background: #2d2d30;
            padding: 2px 6px;
            border-radius: 3px;
            color: #ce9178;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ EsimNativeBridge Test Demo</h1>
        
        <div class="section">
            <h2>ğŸ“Š Bridge Status</h2>
            <div id="bridge-status" class="status info">Checking...</div>
            <div id="bridge-methods"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ” Test 1: Check eSIM Support</h2>
            <button onclick="testIsEsimSupported()">Run Test</button>
            <div id="test1-result"></div>
        </div>
        
        <div class="section">
            <h2>â„¹ï¸ Test 2: Get eSIM Info</h2>
            <button onclick="testGetEsimInfo()">Run Test</button>
            <div id="test2-result"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ“± Test 3: Install eSIM</h2>
            <label for="activation-code">Activation Code:</label>
            <textarea id="activation-code" placeholder="LPA:1$smdp.example.com$activation-code"></textarea>
            <br><br>
            <button onclick="testInstallEsim()">Install eSIM</button>
            <div id="test3-result"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ“ Console Log</h2>
            <button onclick="clearLog()">Clear Log</button>
            <div class="log-container" id="console-log"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ“– How It Works</h2>
            <div class="flow-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Native Android App creates WebView                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. addJavascriptInterface(bridge, "EsimNativeBridge")      â”‚
â”‚    â†’ Creates window.EsimNativeBridge object                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. WebView loads this HTML page                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. JavaScript can now call:                                â”‚
â”‚    window.EsimNativeBridge.installEsim(...)                â”‚
â”‚    window.EsimNativeBridge.isEsimSupported(...)            â”‚
â”‚    window.EsimNativeBridge.getEsimInfo(...)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Native Kotlin methods are executed                      â”‚
â”‚    @JavascriptInterface fun installEsim() { ... }          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Results returned via JavaScript callbacks               â”‚
â”‚    webView.evaluateJavascript("callback('result')", null)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </div>
    </div>
    
    <script>
        // ==================== LOGGING ====================
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span>${message}`;
            
            const logContainer = document.getElementById('console-log');
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Also log to browser console
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('console-log').innerHTML = '';
            log('Log cleared', 'info');
        }
        
        // ==================== BRIDGE DETECTION ====================
        
        function checkBridgeStatus() {
            const statusDiv = document.getElementById('bridge-status');
            const methodsDiv = document.getElementById('bridge-methods');
            
            if (typeof window.EsimNativeBridge === 'undefined') {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ EsimNativeBridge NOT AVAILABLE';
                methodsDiv.innerHTML = `
                    <p style="color: #f48771;">
                        The bridge is not available. This means one of:
                        <br>â€¢ Running in regular browser (not WebView)
                        <br>â€¢ Native app didn't call addJavascriptInterface()
                        <br>â€¢ Wrong interface name (must be "EsimNativeBridge")
                    </p>
                `;
                log('Bridge NOT available', 'error');
                return false;
            } else {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… EsimNativeBridge AVAILABLE';
                
                const methods = Object.keys(window.EsimNativeBridge);
                methodsDiv.innerHTML = `
                    <p style="color: #4ec9b0;">
                        Available methods: <code>${methods.join('</code>, <code>')}</code>
                    </p>
                `;
                log(`Bridge available with methods: ${methods.join(', ')}`, 'success');
                return true;
            }
        }
        
        // ==================== TEST 1: IS ESIM SUPPORTED ====================
        
        function testIsEsimSupported() {
            log('Testing isEsimSupported()...', 'info');
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<div class="status info">Testing...</div>';
            
            if (typeof window.EsimNativeBridge === 'undefined') {
                resultDiv.innerHTML = '<div class="status error">Bridge not available</div>';
                log('Cannot test: Bridge not available', 'error');
                return;
            }
            
            try {
                // Call native method with callback
                window.EsimNativeBridge.isEsimSupported(function(supported) {
                    log(`isEsimSupported callback received: ${supported}`, 'success');
                    
                    if (supported) {
                        resultDiv.innerHTML = '<div class="status success">âœ… Device supports eSIM</div>';
                    } else {
                        resultDiv.innerHTML = '<div class="status warning">âš ï¸ Device does NOT support eSIM</div>';
                    }
                });
                
                log('isEsimSupported() called, waiting for callback...', 'info');
            } catch (e) {
                const error = `Error: ${e.message}`;
                resultDiv.innerHTML = `<div class="status error">${error}</div>`;
                log(error, 'error');
            }
        }
        
        // ==================== TEST 2: GET ESIM INFO ====================
        
        function testGetEsimInfo() {
            log('Testing getEsimInfo()...', 'info');
            const resultDiv = document.getElementById('test2-result');
            resultDiv.innerHTML = '<div class="status info">Testing...</div>';
            
            if (typeof window.EsimNativeBridge === 'undefined') {
                resultDiv.innerHTML = '<div class="status error">Bridge not available</div>';
                log('Cannot test: Bridge not available', 'error');
                return;
            }
            
            try {
                window.EsimNativeBridge.getEsimInfo(function(infoJson) {
                    log(`getEsimInfo callback received: ${infoJson}`, 'success');
                    
                    try {
                        const info = JSON.parse(infoJson);
                        
                        if (info.error) {
                            resultDiv.innerHTML = `
                                <div class="status error">âŒ Error: ${info.error}</div>
                            `;
                        } else {
                            resultDiv.innerHTML = `
                                <div class="status success">
                                    âœ… eSIM Info Retrieved:<br>
                                    EID: <code>${info.eid}</code><br>
                                    Enabled: <strong>${info.enabled}</strong>
                                </div>
                            `;
                        }
                    } catch (e) {
                        resultDiv.innerHTML = `<div class="status error">Failed to parse JSON: ${e.message}</div>`;
                        log(`JSON parse error: ${e.message}`, 'error');
                    }
                });
                
                log('getEsimInfo() called, waiting for callback...', 'info');
            } catch (e) {
                const error = `Error: ${e.message}`;
                resultDiv.innerHTML = `<div class="status error">${error}</div>`;
                log(error, 'error');
            }
        }
        
        // ==================== TEST 3: INSTALL ESIM ====================
        
        function testInstallEsim() {
            log('Testing installEsim()...', 'info');
            const resultDiv = document.getElementById('test3-result');
            const activationCode = document.getElementById('activation-code').value.trim();
            
            if (!activationCode) {
                resultDiv.innerHTML = '<div class="status error">Please enter activation code</div>';
                log('Activation code is empty', 'error');
                return;
            }
            
            resultDiv.innerHTML = '<div class="status info">Installing...</div>';
            log(`Activation code: ${activationCode.substring(0, 30)}...`, 'info');
            
            if (typeof window.EsimNativeBridge === 'undefined') {
                resultDiv.innerHTML = '<div class="status error">Bridge not available</div>';
                log('Cannot install: Bridge not available', 'error');
                return;
            }
            
            try {
                // Define callbacks
                const onSuccess = function(result) {
                    log(`âœ… Install SUCCESS: ${result}`, 'success');
                    resultDiv.innerHTML = `
                        <div class="status success">
                            âœ… Installation Successful<br>
                            ${result}
                        </div>
                    `;
                };
                
                const onError = function(error) {
                    log(`âŒ Install ERROR: ${error}`, 'error');
                    resultDiv.innerHTML = `
                        <div class="status error">
                            âŒ Installation Failed<br>
                            ${error}
                        </div>
                    `;
                };
                
                // Call native method
                window.EsimNativeBridge.installEsim(
                    activationCode,
                    onSuccess,
                    onError
                );
                
                log('installEsim() called, waiting for result...', 'info');
            } catch (e) {
                const error = `Error: ${e.message}`;
                resultDiv.innerHTML = `<div class="status error">${error}</div>`;
                log(error, 'error');
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        window.addEventListener('load', function() {
            log('=== Page Loaded ===', 'info');
            log(`User Agent: ${navigator.userAgent}`, 'info');
            
            // Check bridge status
            checkBridgeStatus();
            
            // If bridge is available, run basic test
            if (typeof window.EsimNativeBridge !== 'undefined') {
                log('Running automatic tests...', 'info');
                setTimeout(() => {
                    testIsEsimSupported();
                    setTimeout(() => testGetEsimInfo(), 1000);
                }, 500);
            }
        });
        
        // Listen for console messages from Flutter
        console.log('Test page ready. Bridge status:', typeof window.EsimNativeBridge);
    </script>
</body>
</html>
